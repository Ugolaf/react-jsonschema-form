"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _utils = require("../../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var nums = new Set(["number", "integer"]);
/**
 * This is a silly limitation in the DOM where option change event values are
 * always retrieved as strings.
 */

function processValue(schema, value) {
  // "enum" is a reserved word, so only "type" and "items" can be destructured
  var type = schema.type,
      items = schema.items;

  if (value === "") {
    return undefined;
  } else if (type === "array" && items && nums.has(items.type)) {
    return value.map(_utils.asNumber);
  } else if (type === "boolean") {
    return value === "true";
  } else if (type === "number") {
    return (0, _utils.asNumber)(value);
  } // If type is undefined, but an enum is present, try and infer the type from
  // the enum values


  if (schema.enum) {
    if (schema.enum.every(function (x) {
      return (0, _utils.guessType)(x) === "number";
    })) {
      return (0, _utils.asNumber)(value);
    } else if (schema.enum.every(function (x) {
      return (0, _utils.guessType)(x) === "boolean";
    })) {
      return value === "true";
    }
  }

  return value;
}

function getValue(event, multiple) {
  if (multiple) {
    return [].slice.call(event.target.options).filter(function (o) {
      return o.selected;
    }).map(function (o) {
      return o.value;
    });
  } else {
    return event.target.value;
  }
}

function SelectWidget(props) {
  var schema = props.schema,
      id = props.id,
      options = props.options,
      value = props.value,
      required = props.required,
      disabled = props.disabled,
      readonly = props.readonly,
      multiple = props.multiple,
      autofocus = props.autofocus,
      _onChange = props.onChange,
      onBlur = props.onBlur,
      onFocus = props.onFocus,
      placeholder = props.placeholder;
  var enumOptions = options.enumOptions,
      enumDisabled = options.enumDisabled;
  var emptyValue = multiple ? [] : "";
  return /*#__PURE__*/_react.default.createElement("select", {
    id: id,
    multiple: multiple,
    className: "form-control",
    value: typeof value === "undefined" ? emptyValue : value,
    required: required,
    disabled: disabled || readonly,
    autoFocus: autofocus,
    onBlur: onBlur && function (event) {
      var newValue = getValue(event, multiple);
      onBlur(id, processValue(schema, newValue));
    },
    onFocus: onFocus && function (event) {
      var newValue = getValue(event, multiple);
      onFocus(id, processValue(schema, newValue));
    },
    onChange: function onChange(event) {
      var newValue = getValue(event, multiple);

      _onChange(processValue(schema, newValue));
    }
  }, !multiple && schema.default === undefined && /*#__PURE__*/_react.default.createElement("option", {
    value: ""
  }, placeholder), enumOptions.map(function (_ref, i) {
    var value = _ref.value,
        label = _ref.label;
    var disabled = enumDisabled && enumDisabled.indexOf(value) != -1;
    return /*#__PURE__*/_react.default.createElement("option", {
      key: i,
      value: value,
      disabled: disabled
    }, label);
  }));
}

SelectWidget.defaultProps = {
  autofocus: false
};

if (process.env.NODE_ENV !== "production") {
  SelectWidget.propTypes = {
    schema: _propTypes.default.object.isRequired,
    id: _propTypes.default.string.isRequired,
    options: _propTypes.default.shape({
      enumOptions: _propTypes.default.array
    }).isRequired,
    value: _propTypes.default.any,
    required: _propTypes.default.bool,
    disabled: _propTypes.default.bool,
    readonly: _propTypes.default.bool,
    multiple: _propTypes.default.bool,
    autofocus: _propTypes.default.bool,
    onChange: _propTypes.default.func,
    onBlur: _propTypes.default.func,
    onFocus: _propTypes.default.func
  };
}

var _default = SelectWidget;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3dpZGdldHMvU2VsZWN0V2lkZ2V0LmpzIl0sIm5hbWVzIjpbIm51bXMiLCJTZXQiLCJwcm9jZXNzVmFsdWUiLCJzY2hlbWEiLCJ2YWx1ZSIsInR5cGUiLCJpdGVtcyIsInVuZGVmaW5lZCIsImhhcyIsIm1hcCIsImFzTnVtYmVyIiwiZW51bSIsImV2ZXJ5IiwieCIsImdldFZhbHVlIiwiZXZlbnQiLCJtdWx0aXBsZSIsInNsaWNlIiwiY2FsbCIsInRhcmdldCIsIm9wdGlvbnMiLCJmaWx0ZXIiLCJvIiwic2VsZWN0ZWQiLCJTZWxlY3RXaWRnZXQiLCJwcm9wcyIsImlkIiwicmVxdWlyZWQiLCJkaXNhYmxlZCIsInJlYWRvbmx5IiwiYXV0b2ZvY3VzIiwib25DaGFuZ2UiLCJvbkJsdXIiLCJvbkZvY3VzIiwicGxhY2Vob2xkZXIiLCJlbnVtT3B0aW9ucyIsImVudW1EaXNhYmxlZCIsImVtcHR5VmFsdWUiLCJuZXdWYWx1ZSIsImRlZmF1bHQiLCJpIiwibGFiZWwiLCJpbmRleE9mIiwiZGVmYXVsdFByb3BzIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCIsInN0cmluZyIsInNoYXBlIiwiYXJyYXkiLCJhbnkiLCJib29sIiwiZnVuYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBOzs7O0FBRUEsSUFBTUEsSUFBSSxHQUFHLElBQUlDLEdBQUosQ0FBUSxDQUFDLFFBQUQsRUFBVyxTQUFYLENBQVIsQ0FBYjtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFNBQVNDLFlBQVQsQ0FBc0JDLE1BQXRCLEVBQThCQyxLQUE5QixFQUFxQztBQUNuQztBQUNBLE1BQVFDLElBQVIsR0FBd0JGLE1BQXhCLENBQVFFLElBQVI7QUFBQSxNQUFjQyxLQUFkLEdBQXdCSCxNQUF4QixDQUFjRyxLQUFkOztBQUNBLE1BQUlGLEtB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LG1CQUFVUSxJQWJLO0FBY3ZCdkIsSUFBQUEsT0FBTyxFQUFFZSxtQkFBVVE7QUFkSSxHQUF6QjtBQWdCRDs7ZUFFY2hDLFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcclxuXHJcbmltcG9ydCB7IGFzTnVtYmVyLCBndWVzc1R5cGUgfSBmcm9tIFwiLi4vLi4vdXRpbHNcIjtcclxuXHJcbmNvbnN0IG51bXMgPSBuZXcgU2V0KFtcIm51bWJlclwiLCBcImludGVnZXJcIl0pO1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgaXMgYSBzaWxseSBsaW1pdGF0aW9uIGluIHRoZSBET00gd2hlcmUgb3B0aW9uIGNoYW5nZSBldmVudCB2YWx1ZXMgYXJlXHJcbiAqIGFsd2F5cyByZXRyaWV2ZWQgYXMgc3RyaW5ncy5cclxuICovXHJcbmZ1bmN0aW9uIHByb2Nlc3NWYWx1ZShzY2hlbWEsIHZhbHVlKSB7XHJcbiAgLy8gXCJlbnVtXCIgaXMgYSByZXNlcnZlZCB3b3JkLCBzbyBvbmx5IFwidHlwZVwiIGFuZCBcIml0ZW1zXCIgY2FuIGJlIGRlc3RydWN0dXJlZFxyXG4gIGNvbnN0IHsgdHlwZSwgaXRlbXMgfSA9IHNjaGVtYTtcclxuICBpZiAodmFsdWUgPT09IFwiXCIpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImFycmF5XCIgJiYgaXRlbXMgJiYgbnVtcy5oYXMoaXRlbXMudHlwZSkpIHtcclxuICAgIHJldHVybiB2YWx1ZS5tYXAoYXNOdW1iZXIpO1xyXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcIm51bWJlclwiKSB7XHJcbiAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gSWYgdHlwZSBpcyB1bmRlZmluZWQsIGJ1dCBhbiBlbnVtIGlzIHByZXNlbnQsIHRyeSBhbmQgaW5mZXIgdGhlIHR5cGUgZnJvbVxyXG4gIC8vIHRoZSBlbnVtIHZhbHVlc1xyXG4gIGlmIChzY2hlbWEuZW51bSkge1xyXG4gICAgaWYgKHNjaGVtYS5lbnVtLmV2ZXJ5KHggPT4gZ3Vlc3NUeXBlKHgpID09PSBcIm51bWJlclwiKSkge1xyXG4gICAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmIChzY2hlbWEuZW51bS5ldmVyeSh4ID0+IGd1ZXNzVHlwZSh4KSA9PT0gXCJib29sZWFuXCIpKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdmFsdWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFZhbHVlKGV2ZW50LCBtdWx0aXBsZSkge1xyXG4gIGlmIChtdWx0aXBsZSkge1xyXG4gICAgcmV0dXJuIFtdLnNsaWNlXHJcbiAgICAgIC5jYWxsKGV2ZW50LnRhcmdldC5vcHRpb25zKVxyXG4gICAgICAuZmlsdGVyKG8gPT4gby5zZWxlY3RlZClcclxuICAgICAgLm1hcChvID0+IG8udmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gU2VsZWN0V2lkZ2V0KHByb3BzKSB7XHJcbiAgY29uc3Qge1xyXG4gICAgc2NoZW1hLFxyXG4gICAgaWQsXHJcbiAgICBvcHRpb25zLFxyXG4gICAgdmFsdWUsXHJcbiAgICByZXF1aXJlZCxcclxuICAgIGRpc2FibGVkLFxyXG4gICAgcmVhZG9ubHksXHJcbiAgICBtdWx0aXBsZSxcclxuICAgIGF1dG9mb2N1cyxcclxuICAgIG9uQ2hhbmdlLFxyXG4gICAgb25CbHVyLFxyXG4gICAgb25Gb2N1cyxcclxuICAgIHBsYWNlaG9sZGVyLFxyXG4gIH0gPSBwcm9wcztcclxuICBjb25zdCB7IGVudW1PcHRpb25zLCBlbnVtRGlzYWJsZWQgfSA9IG9wdGlvbnM7XHJcbiAgY29uc3QgZW1wdHlWYWx1ZSA9IG11bHRpcGxlID8gW10gOiBcIlwiO1xyXG4gIHJldHVybiAoXHJcbiAgICA8c2VsZWN0XHJcbiAgICAgIGlkPXtpZH1cclxuICAgICAgbXVsdGlwbGU9e211bHRpcGxlfVxyXG4gICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIlxyXG4gICAgICB2YWx1ZT17dHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gZW1wdHlWYWx1ZSA6IHZhbHVlfVxyXG4gICAgICByZXF1aXJlZD17cmVxdWlyZWR9XHJcbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZCB8fCByZWFkb25seX1cclxuICAgICAgYXV0b0ZvY3VzPXthdXRvZm9jdXN9XHJcbiAgICAgIG9uQmx1cj17XHJcbiAgICAgICAgb25CbHVyICYmXHJcbiAgICAgICAgKGV2ZW50ID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZ2V0VmFsdWUoZXZlbnQsIG11bHRpcGxlKTtcclxuICAgICAgICAgIG9uQmx1cihpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uRm9jdXM9e1xyXG4gICAgICAgIG9uRm9jdXMgJiZcclxuICAgICAgICAoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgICAgb25Gb2N1cyhpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgIG9uQ2hhbmdlKHByb2Nlc3NWYWx1ZShzY2hlbWEsIG5ld1ZhbHVlKSk7XHJcbiAgICAgIH19PlxyXG4gICAgICB7IW11bHRpcGxlICYmIHNjaGVtYS5kZWZhdWx0ID09PSB1bmRlZmluZWQgJiYgKFxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj57cGxhY2Vob2xkZXJ9PC9vcHRpb24+XHJcbiAgICAgICl9XHJcbiAgICAgIHtlbnVtT3B0aW9ucy5tYXAoKHsgdmFsdWUsIGxhYmVsIH0sIGkpID0+IHtcclxuICAgICAgICBjb25zdCBkaXNhYmxlZCA9IGVudW1EaXNhYmxlZCAmJiBlbnVtRGlzYWJsZWQuaW5kZXhPZih2YWx1ZSkgIT0gLTE7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIDxvcHRpb24ga2V5PXtpfSB2YWx1ZT17dmFsdWV9IGRpc2FibGVkPXtkaXNhYmxlZH0+XHJcbiAgICAgICAgICAgIHtsYWJlbH1cclxuICAgICAgICAgIDwvb3B0aW9uPlxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pfVxyXG4gICAgPC9zZWxlY3Q+XHJcbiAgKTtcclxufVxyXG5cclxuU2VsZWN0V2lkZ2V0LmRlZmF1bHRQcm9wcyA9IHtcclxuICBhdXRvZm9jdXM6IGZhbHNlLFxyXG59O1xyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gIFNlbGVjdFdpZGdldC5wcm9wVHlwZXMgPSB7XHJcbiAgICBzY2hlbWE6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcclxuICAgIGlkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICBlbnVtT3B0aW9uczogUHJvcFR5cGVzLmFycmF5LFxyXG4gICAgfSkuaXNSZXF1aXJlZCxcclxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55LFxyXG4gICAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgcmVhZG9ubHk6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgbXVsdGlwbGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgYXV0b2ZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcclxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvbkZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWxlY3RXaWRnZXQ7XHJcbiJdfQ==