import React from "react";
import PropTypes from "prop-types";
import { asNumber, guessType } from "../../utils";
var nums = new Set(["number", "integer"]);
/**
 * This is a silly limitation in the DOM where option change event values are
 * always retrieved as strings.
 */

function processValue(schema, value) {
  // "enum" is a reserved word, so only "type" and "items" can be destructured
  var type = schema.type,
      items = schema.items;

  if (value === "") {
    return undefined;
  } else if (type === "array" && items && nums.has(items.type)) {
    return value.map(asNumber);
  } else if (type === "boolean") {
    return value === "true";
  } else if (type === "number") {
    return asNumber(value);
  } // If type is undefined, but an enum is present, try and infer the type from
  // the enum values


  if (schema.enum) {
    if (schema.enum.every(function (x) {
      return guessType(x) === "number";
    })) {
      return asNumber(value);
    } else if (schema.enum.every(function (x) {
      return guessType(x) === "boolean";
    })) {
      return value === "true";
    }
  }

  return value;
}

function getValue(event, multiple) {
  if (multiple) {
    return [].slice.call(event.target.options).filter(function (o) {
      return o.selected;
    }).map(function (o) {
      return o.value;
    });
  } else {
    return event.target.value;
  }
}

function SelectWidget(props) {
  var schema = props.schema,
      id = props.id,
      options = props.options,
      value = props.value,
      required = props.required,
      disabled = props.disabled,
      readonly = props.readonly,
      multiple = props.multiple,
      autofocus = props.autofocus,
      _onChange = props.onChange,
      onBlur = props.onBlur,
      onFocus = props.onFocus,
      placeholder = props.placeholder;
  var enumOptions = options.enumOptions,
      enumDisabled = options.enumDisabled;
  var emptyValue = multiple ? [] : "";
  return /*#__PURE__*/React.createElement("select", {
    id: id,
    multiple: multiple,
    className: "form-control",
    value: typeof value === "undefined" ? emptyValue : value,
    required: required,
    disabled: disabled || readonly,
    autoFocus: autofocus,
    onBlur: onBlur && function (event) {
      var newValue = getValue(event, multiple);
      onBlur(id, processValue(schema, newValue));
    },
    onFocus: onFocus && function (event) {
      var newValue = getValue(event, multiple);
      onFocus(id, processValue(schema, newValue));
    },
    onChange: function onChange(event) {
      var newValue = getValue(event, multiple);

      _onChange(processValue(schema, newValue));
    }
  }, !multiple && schema.default === undefined && /*#__PURE__*/React.createElement("option", {
    value: ""
  }, placeholder), enumOptions.map(function (_ref, i) {
    var value = _ref.value,
        label = _ref.label;
    var disabled = enumDisabled && enumDisabled.indexOf(value) != -1;
    return /*#__PURE__*/React.createElement("option", {
      key: i,
      value: value,
      disabled: disabled
    }, label);
  }));
}

SelectWidget.defaultProps = {
  autofocus: false
};

if (process.env.NODE_ENV !== "production") {
  SelectWidget.propTypes = {
    schema: PropTypes.object.isRequired,
    id: PropTypes.string.isRequired,
    options: PropTypes.shape({
      enumOptions: PropTypes.array
    }).isRequired,
    value: PropTypes.any,
    required: PropTypes.bool,
    disabled: PropTypes.bool,
    readonly: PropTypes.bool,
    multiple: PropTypes.bool,
    autofocus: PropTypes.bool,
    onChange: PropTypes.func,
    onBlur: PropTypes.func,
    onFocus: PropTypes.func
  };
}

export default SelectWidget;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3dpZGdldHMvU2VsZWN0V2lkZ2V0LmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiUHJvcFR5cGVzIiwiYXNOdW1iZXIiLCJndWVzc1R5cGUiLCJudW1zIiwiU2V0IiwicHJvY2Vzc1ZhbHVlIiwic2NoZW1hIiwidmFsdWUiLCJ0eXBlIiwiaXRlbXMiLCJ1bmRlZmluZWQiLCJoYXMiLCJtYXAiLCJlbnVtIiwiZXZlcnkiLCJ4IiwiZ2V0VmFsdWUiLCJldmVudCIsIm11bHRpcGxlIiwic2xpY2UiLCJjYWxsIiwidGFyZ2V0Iiwib3B0aW9ucyIsImZpbHRlciIsIm8iLCJzZWxlY3RlZCIsIlNlbGVjdFdpZGdldCIsInByb3BzIiwiaWQiLCJyZXF1aXJlZCIsImRpc2FibGVkIiwicmVhZG9ubHkiLCJhdXRvZm9jdXMiLCJvbkNoYW5nZSIsIm9uQmx1ciIsIm9uRm9jdXMiLCJwbGFjZWhvbGRlciIsImVudW1PcHRpb25zIiwiZW51bURpc2FibGVkIiwiZW1wdHlWYWx1ZSIsIm5ld1ZhbHVlIiwiZGVmYXVsdCIsImkiLCJsYWJlbCIsImluZGV4T2YiLCJkZWZhdWx0UHJvcHMiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJwcm9wVHlwZXMiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwic3RyaW5nIiwic2hhcGUiLCJhcnJheSIsImFueSIsImJvb2wiLCJmdW5jIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxLQUFQLE1BQWtCLE9BQWxCO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixZQUF0QjtBQUVBLFNBQVNDLFFBQVQsRUFBbUJDLFNBQW5CLFFBQW9DLGFBQXBDO0FBRUEsSUFBTUMsSUFBSSxHQUFHLElBQUlDLEdBQUosQ0FBUSxDQUFDLFFBQUQsRUFBVyxTQUFYLENBQVIsQ0FBYjtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFNBQVNDLFlBQVQsQ0FBc0JDLE1BQXRCLEVBQThCQyxLQUE5QixFQUFxQztBQUNuQztBQUNB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QixTQUFTLENBQUN3RCxJQVRHO0FBVXZCdEMsSUFBQUEsUUFBUSxFQUFFbEIsU0FBUyxDQUFDd0QsSUFWRztBQVd2QnhCLElBQUFBLFNBQVMsRUFBRWhDLFNBQVMsQ0FBQ3dELElBWEU7QUFZdkJ2QixJQUFBQSxRQUFRLEVBQUVqQyxTQUFTLENBQUN5RCxJQVpHO0FBYXZCdkIsSUFBQUEsTUFBTSxFQUFFbEMsU0FBUyxDQUFDeUQsSUFiSztBQWN2QnRCLElBQUFBLE9BQU8sRUFBRW5DLFNBQVMsQ0FBQ3lEO0FBZEksR0FBekI7QUFnQkQ7O0FBRUQsZUFBZS9CLFlBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcclxuXHJcbmltcG9ydCB7IGFzTnVtYmVyLCBndWVzc1R5cGUgfSBmcm9tIFwiLi4vLi4vdXRpbHNcIjtcclxuXHJcbmNvbnN0IG51bXMgPSBuZXcgU2V0KFtcIm51bWJlclwiLCBcImludGVnZXJcIl0pO1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgaXMgYSBzaWxseSBsaW1pdGF0aW9uIGluIHRoZSBET00gd2hlcmUgb3B0aW9uIGNoYW5nZSBldmVudCB2YWx1ZXMgYXJlXHJcbiAqIGFsd2F5cyByZXRyaWV2ZWQgYXMgc3RyaW5ncy5cclxuICovXHJcbmZ1bmN0aW9uIHByb2Nlc3NWYWx1ZShzY2hlbWEsIHZhbHVlKSB7XHJcbiAgLy8gXCJlbnVtXCIgaXMgYSByZXNlcnZlZCB3b3JkLCBzbyBvbmx5IFwidHlwZVwiIGFuZCBcIml0ZW1zXCIgY2FuIGJlIGRlc3RydWN0dXJlZFxyXG4gIGNvbnN0IHsgdHlwZSwgaXRlbXMgfSA9IHNjaGVtYTtcclxuICBpZiAodmFsdWUgPT09IFwiXCIpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImFycmF5XCIgJiYgaXRlbXMgJiYgbnVtcy5oYXMoaXRlbXMudHlwZSkpIHtcclxuICAgIHJldHVybiB2YWx1ZS5tYXAoYXNOdW1iZXIpO1xyXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcIm51bWJlclwiKSB7XHJcbiAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gSWYgdHlwZSBpcyB1bmRlZmluZWQsIGJ1dCBhbiBlbnVtIGlzIHByZXNlbnQsIHRyeSBhbmQgaW5mZXIgdGhlIHR5cGUgZnJvbVxyXG4gIC8vIHRoZSBlbnVtIHZhbHVlc1xyXG4gIGlmIChzY2hlbWEuZW51bSkge1xyXG4gICAgaWYgKHNjaGVtYS5lbnVtLmV2ZXJ5KHggPT4gZ3Vlc3NUeXBlKHgpID09PSBcIm51bWJlclwiKSkge1xyXG4gICAgICByZXR1cm4gYXNOdW1iZXIodmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmIChzY2hlbWEuZW51bS5ldmVyeSh4ID0+IGd1ZXNzVHlwZSh4KSA9PT0gXCJib29sZWFuXCIpKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gXCJ0cnVlXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdmFsdWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFZhbHVlKGV2ZW50LCBtdWx0aXBsZSkge1xyXG4gIGlmIChtdWx0aXBsZSkge1xyXG4gICAgcmV0dXJuIFtdLnNsaWNlXHJcbiAgICAgIC5jYWxsKGV2ZW50LnRhcmdldC5vcHRpb25zKVxyXG4gICAgICAuZmlsdGVyKG8gPT4gby5zZWxlY3RlZClcclxuICAgICAgLm1hcChvID0+IG8udmFsdWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gU2VsZWN0V2lkZ2V0KHByb3BzKSB7XHJcbiAgY29uc3Qge1xyXG4gICAgc2NoZW1hLFxyXG4gICAgaWQsXHJcbiAgICBvcHRpb25zLFxyXG4gICAgdmFsdWUsXHJcbiAgICByZXF1aXJlZCxcclxuICAgIGRpc2FibGVkLFxyXG4gICAgcmVhZG9ubHksXHJcbiAgICBtdWx0aXBsZSxcclxuICAgIGF1dG9mb2N1cyxcclxuICAgIG9uQ2hhbmdlLFxyXG4gICAgb25CbHVyLFxyXG4gICAgb25Gb2N1cyxcclxuICAgIHBsYWNlaG9sZGVyLFxyXG4gIH0gPSBwcm9wcztcclxuICBjb25zdCB7IGVudW1PcHRpb25zLCBlbnVtRGlzYWJsZWQgfSA9IG9wdGlvbnM7XHJcbiAgY29uc3QgZW1wdHlWYWx1ZSA9IG11bHRpcGxlID8gW10gOiBcIlwiO1xyXG4gIHJldHVybiAoXHJcbiAgICA8c2VsZWN0XHJcbiAgICAgIGlkPXtpZH1cclxuICAgICAgbXVsdGlwbGU9e211bHRpcGxlfVxyXG4gICAgICBjbGFzc05hbWU9XCJmb3JtLWNvbnRyb2xcIlxyXG4gICAgICB2YWx1ZT17dHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gZW1wdHlWYWx1ZSA6IHZhbHVlfVxyXG4gICAgICByZXF1aXJlZD17cmVxdWlyZWR9XHJcbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZCB8fCByZWFkb25seX1cclxuICAgICAgYXV0b0ZvY3VzPXthdXRvZm9jdXN9XHJcbiAgICAgIG9uQmx1cj17XHJcbiAgICAgICAgb25CbHVyICYmXHJcbiAgICAgICAgKGV2ZW50ID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZ2V0VmFsdWUoZXZlbnQsIG11bHRpcGxlKTtcclxuICAgICAgICAgIG9uQmx1cihpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uRm9jdXM9e1xyXG4gICAgICAgIG9uRm9jdXMgJiZcclxuICAgICAgICAoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgICAgb25Gb2N1cyhpZCwgcHJvY2Vzc1ZhbHVlKHNjaGVtYSwgbmV3VmFsdWUpKTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBnZXRWYWx1ZShldmVudCwgbXVsdGlwbGUpO1xyXG4gICAgICAgIG9uQ2hhbmdlKHByb2Nlc3NWYWx1ZShzY2hlbWEsIG5ld1ZhbHVlKSk7XHJcbiAgICAgIH19PlxyXG4gICAgICB7IW11bHRpcGxlICYmIHNjaGVtYS5kZWZhdWx0ID09PSB1bmRlZmluZWQgJiYgKFxyXG4gICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj57cGxhY2Vob2xkZXJ9PC9vcHRpb24+XHJcbiAgICAgICl9XHJcbiAgICAgIHtlbnVtT3B0aW9ucy5tYXAoKHsgdmFsdWUsIGxhYmVsIH0sIGkpID0+IHtcclxuICAgICAgICBjb25zdCBkaXNhYmxlZCA9IGVudW1EaXNhYmxlZCAmJiBlbnVtRGlzYWJsZWQuaW5kZXhPZih2YWx1ZSkgIT0gLTE7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIDxvcHRpb24ga2V5PXtpfSB2YWx1ZT17dmFsdWV9IGRpc2FibGVkPXtkaXNhYmxlZH0+XHJcbiAgICAgICAgICAgIHtsYWJlbH1cclxuICAgICAgICAgIDwvb3B0aW9uPlxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pfVxyXG4gICAgPC9zZWxlY3Q+XHJcbiAgKTtcclxufVxyXG5cclxuU2VsZWN0V2lkZ2V0LmRlZmF1bHRQcm9wcyA9IHtcclxuICBhdXRvZm9jdXM6IGZhbHNlLFxyXG59O1xyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gIFNlbGVjdFdpZGdldC5wcm9wVHlwZXMgPSB7XHJcbiAgICBzY2hlbWE6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcclxuICAgIGlkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICBlbnVtT3B0aW9uczogUHJvcFR5cGVzLmFycmF5LFxyXG4gICAgfSkuaXNSZXF1aXJlZCxcclxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55LFxyXG4gICAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgcmVhZG9ubHk6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgbXVsdGlwbGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgYXV0b2ZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcclxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvbkZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWxlY3RXaWRnZXQ7XHJcbiJdfQ==